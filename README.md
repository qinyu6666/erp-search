# erp-search
用dify实现自然语言描述来实现传统商业软件ERP的增删改查操作

SAP财务软件ERP，使用起来要求专业性比较高，培训成本很大，目前需求是让非财务背景的操作人员也可直接上手操作，通过用自然语言描述来实现各种增删改查操作，整体工作流用dify来配置，通过http节点调用erp业务的API，再给AI大模型相关的prompt，执行出最后想要的结果。整体操作更加简化方便，节省培训成本。

SAP财务模块自然语言到SQL智能操作平台需求规格说明书 V1.0

1，	业务背景
SAP FI/CO 模块功能强大，但事务码（T-code）繁多、字段命名抽象、表间关联复杂，导致非财务背景的业务人员（“小白用户”）学习曲线陡峭、培训成本高。本需求旨在通过大模型驱动的 NL2SQL 引擎，将自然语言指令实时转换为 SAP 的SQLScript，并自动执行、回显结果，实现“零培训”式增删改查。

2，	目标用户
• 无 SAP 操作经验的业务人员（报销、预算、采购、销售等角色）
• 财务共享中心初级员工
• 管理层临时查询需求

3，	功能需求（FR）
3.1 自然语言解析
   a. 支持中文/英文混合输入，允许口语化、缩写、错别字容错。
   b. 语义槽位识别：操作类型（C/R/U/D）、表/视图、字段、过滤条件、聚合、排序、分页、时间范围、金额区间、组织维度（公司代码、利润中心、成本中心等）。
   c. 上下文继承：多轮对话保持会话状态，支持指代消解（“把刚才那张凭证改成…”）。

3.2  SQL 自动生成
   a. 输出符合 SAP HANA SQLScript 语法的可执行语句，兼容 CDS View、表函数、权限视图。
   b. 自动处理表间 JOIN（BKPF-BSEG、ACDOCA、SKA1、T001 等），自动补全主键、客户端字段 (MANDT)。
   c. 对写操作（C/U/D）自动生成含乐观锁、行级权限校验的语句模板，预生成回滚脚本。

3.3 权限与安全
   a. 与 SAP GRC/BRF+ 集成，实时校验用户角色、授权对象（F_BKPF_BUK、F_BKPF_KOA 等）。
   b. 写操作需触发二次审批流（OA/邮件/Teams Bot），审批通过后由后台服务账号执行。
   c. 所有 SQL 与执行结果写入审计日志表 ZNL2SQL_AUDIT，保留 10 年。

3.4 结果可视化
   a. 查询结果以卡片、表格、图表（ECharts）多视图展示，支持一键导出 Excel/PDF。
   b. 对写操作返回受影响的行数、凭证号、消息号 (SY-MSGID/SY-MSGNO)。
   c. 异常结果（如违反校验规则）以红色高亮并给出自然语言解释。

3.5 反馈与持续学习
   a. 用户可对生成 SQL 进行“正确/错误”标记，数据回流至微调语料库，周级增量训练。
   b. 支持 A/B 测试：灰度发布新模型，对比准确率、执行成功率。

4，	非功能需求（NFR）
4.1 性能
 • 查询类 NL2SQL 平均响应 ≤ 1.5 s（含权限校验）。
 • 并发 200 用户，CPU 利用率 < 60 %。

4.2 准确率
     在内部测试集（5000 条真实用户语句）上，SQL 逻辑正确率 ≥ 95 %；写操作零误   杀率 100 %。

4.3 可用性
     7×24 运行，年可用性 ≥ 99.9 %。

4.4 安全合规
     符合 SOX、GDPR等保 3 级，敏感字段自动脱敏。

5，	技术约束
• 后端：SAP BTP ABAP Environment 或独立微服务（Python 3.11 + FastAPI），通过 RFC/ODBC 连接
• 前端：Fiori Elements / React SPA
• 模型：私有化部署 ChatGPT-4o + LoRA 微调，推理 GPU A100
• 版本控制：SQL 模板与模型权重统一纳入 GitLab CI/CD。

6，	开发里程碑
需求澄清 & 原型（4 周）
NL2SQL 引擎 Beta + 只读查询上线（8 周）
写操作 + 审批流上线（12 周）
全量推广 & 培训材料（16 周）

7，	验收标准
用户验收测试 (UAT) 通过率 ≥ 95%
培训时长由原来30天缩短至30分钟线上自学
上线 3 个月内，财务共享中心 SAP 运维工单量下降 ≥ 40 % 


